module.exports=[77593,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(7291),e=a.i(50944),f=a.i(63787);let g=({deadline:a})=>{let[d,e]=(0,c.useState)({days:0,hours:0,minutes:0,seconds:0,isOverdue:!1});return((0,c.useEffect)(()=>{let b=()=>{let b=new Date().getTime(),c=new Date(a).getTime();if(isNaN(c))return void e({days:0,hours:0,minutes:0,seconds:0,isOverdue:!1});let d=c-b;d<=0?e({days:0,hours:0,minutes:0,seconds:0,isOverdue:!0}):e({days:Math.floor(d/864e5),hours:Math.floor(d%864e5/36e5),minutes:Math.floor(d%36e5/6e4),seconds:Math.floor(d%6e4/1e3),isOverdue:!1})};b();let c=setInterval(b,1e3);return()=>clearInterval(c)},[a]),!a||isNaN(new Date(a).getTime()))?(0,b.jsxs)("div",{className:"flex items-center gap-1 text-gray-500 text-sm",children:[(0,b.jsx)("span",{children:"ðŸ“…"}),(0,b.jsx)("span",{children:"Deadline tidak valid"})]}):d.isOverdue?(0,b.jsxs)("div",{className:"flex items-center gap-1 text-red-600 font-semibold text-sm",children:[(0,b.jsx)("span",{children:"âš "}),(0,b.jsx)("span",{children:"TELAT"})]}):d.days>30?(0,b.jsxs)("div",{className:"flex items-center gap-1 text-green-600 text-sm",children:[(0,b.jsx)("span",{children:"ðŸ“…"}),(0,b.jsxs)("span",{children:[d.days," hari"]})]}):d.days>7?(0,b.jsxs)("div",{className:"flex items-center gap-1 text-orange-500 text-sm",children:[(0,b.jsx)("span",{children:"âŒ›"}),(0,b.jsxs)("span",{children:[d.days," hari"]})]}):d.days>0?(0,b.jsxs)("div",{className:"flex items-center gap-1 text-red-500 font-semibold text-sm",children:[(0,b.jsx)("span",{children:"ðŸš¨"}),(0,b.jsxs)("span",{children:[d.days,"d ",d.hours,"h"]})]}):(0,b.jsxs)("div",{className:"flex items-center gap-1 text-red-600 font-bold text-sm",children:[(0,b.jsx)("span",{children:"ðŸ”¥"}),(0,b.jsxs)("span",{children:[d.hours,"j ",d.minutes,"m ",d.seconds,"d"]})]})},h=()=>{let[a,d]=(0,c.useState)(null),[e,f]=(0,c.useState)(null);return((0,c.useEffect)(()=>{let a=localStorage.getItem("userEmail"),b=localStorage.getItem("userProfile");d(a),f(b)},[]),a)?(0,b.jsxs)("div",{className:"flex items-center gap-3 bg-blue-50 px-3 py-2 rounded-lg border border-blue-200",children:[(0,b.jsx)("img",{src:e||`https://ui-avatars.com/api/?name=${encodeURIComponent(a.split("@")[0])}&background=random`,alt:"Profile",className:"w-8 h-8 rounded-full"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm font-medium text-gray-800",children:a}),(0,b.jsx)("div",{className:"text-xs text-gray-500 capitalize",children:localStorage.getItem("userRole")})]})]}):null};function i(){let[a,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(!1),[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)(null),p=(0,e.useRouter)(),[q,r]=(0,c.useState)({project_code:"",job_name:"",no_rks:"",date:"",client:"",address:"",time_schedule:"",deadline:""}),[s,t]=(0,c.useState)(!1);(0,c.useEffect)(()=>{t(!0)},[]),(0,c.useEffect)(()=>{!async function(){let{data:{user:a}}=await d.supabase.auth.getUser();if(!a)return p.push("/");let b=localStorage.getItem("userEmail"),c=localStorage.getItem("userRole");if(b&&c)o(b),m(c);else{o(a.email||null);let{data:b,error:c}=await d.supabase.from("users").select("role").eq("email",a.email).single();!c&&b&&(m(b.role),localStorage.setItem("userRole",b.role))}}()},[p]),(0,c.useEffect)(()=>{v();let a=d.supabase.channel("public:projects").on("postgres_changes",{event:"*",schema:"public",table:"projects"},()=>v()).subscribe();return()=>{d.supabase.removeChannel(a)}},[]);let u=async()=>{try{let{count:a}=await d.supabase.from("projects").select("*",{count:"exact",head:!0}),b=new Date().toISOString().split("T")[0].replace(/-/g,"");return`P-EUI-${((a||0)+1).toString().padStart(3,"0")}-${b}`}catch(b){console.error("Error generating project code:",b);let a=new Date().toISOString().split("T")[0].replace(/-/g,"");return`P-EUI-001-${a}`}};async function v(){k(!0);try{let{data:a,error:b}=await d.supabase.from("projects").select("*").order("created_at",{ascending:!1});b?(console.error("fetchProjects error:",b),i([])):i(a||[])}catch(a){console.error("fetchProjects exception:",a),i([])}finally{k(!1)}}async function w(){if(!q.job_name?.trim())return void alert("Job Name harus diisi!");if(!q.deadline)return void alert("Deadline harus diisi!");let a=new Date;if(a.setHours(0,0,0,0),new Date(q.deadline)<a)return void alert("Deadline tidak boleh sebelum hari ini!");k(!0);try{let a=q.project_code||await u(),b={name:q.job_name,description:`Proyek: ${q.job_name} | Client: ${q.client||"-"} | Lokasi: ${q.address||"-"}`,status:"ongoing",meta:{project_code:a,job_name:q.job_name,no_rks:q.no_rks||"",date:q.date||"",client:q.client||"",address:q.address||"",time_schedule:q.time_schedule||"",deadline:q.deadline,created_by:n}};try{b.deadline=q.deadline}catch(a){console.warn("Kolom deadline tidak tersedia, menggunakan meta saja:",a)}let{error:c}=await d.supabase.from("projects").insert(b);if(c)if(console.error("addProject error:",c),c.message.includes("deadline")){console.log("Kolom deadline tidak ditemukan, mencoba tanpa deadline..."),delete b.deadline;let{error:a}=await d.supabase.from("projects").insert(b);if(a)throw a}else throw c;let e=await u();r({project_code:e,job_name:"",no_rks:"",date:new Date().toISOString().split("T")[0],client:"",address:"",time_schedule:"",deadline:""}),v(),alert("âœ… Proyek berhasil ditambahkan!")}catch(a){console.error(a),alert("Terjadi kesalahan: "+a.message)}finally{k(!1)}}async function x(a){if(confirm("Hapus project ini?")){k(!0);try{let{error:b}=await d.supabase.from("projects").delete().eq("id",a);b?(console.error("deleteProject error:",b),alert("Gagal menghapus: "+b.message)):v()}catch(a){console.error(a),alert("Terjadi kesalahan.")}finally{k(!1)}}}(0,c.useEffect)(()=>{!async function(){let a=await u();r(b=>({...b,project_code:a,date:new Date().toISOString().split("T")[0]}))}()},[]);let y=a=>new Date(a).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"});return s?(0,b.jsxs)("div",{className:"p-6 min-h-screen bg-gray-100",children:[(0,b.jsxs)("header",{className:"flex justify-between items-center mb-6",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold",children:"Daftar Proyek"}),(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)(h,{}),(0,b.jsx)("button",{onClick:f.handleLogout,className:"rounded bg-red-500 px-3 py-1 text-white hover:bg-red-600",children:"Logout"})]})]}),(0,b.jsxs)("div",{className:"bg-white rounded shadow p-4 mb-6",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Tambah Proyek Baru"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm mb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"KODE PROYEK"}),(0,b.jsx)("div",{className:"font-semibold text-gray-800 p-2 border rounded bg-gray-50 min-h-[42px]",children:q.project_code||"Generating..."}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Auto-generated"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"JOB NAME *"}),(0,b.jsx)("input",{type:"text",value:q.job_name||"",onChange:a=>r(b=>({...b,job_name:a.target.value})),className:"w-full p-2 border rounded text-sm",placeholder:"Masukkan job name",required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"NO RKS"}),(0,b.jsx)("input",{type:"text",value:q.no_rks||"",onChange:a=>r(b=>({...b,no_rks:a.target.value})),className:"w-full p-2 border rounded text-sm",placeholder:"Masukkan no RKS"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"TANGGAL MULAI"}),(0,b.jsx)("input",{type:"date",value:q.date||"",onChange:a=>r(b=>({...b,date:a.target.value})),className:"w-full p-2 border rounded text-sm"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"CLIENT"}),(0,b.jsx)("input",{type:"text",value:q.client||"",onChange:a=>r(b=>({...b,client:a.target.value})),className:"w-full p-2 border rounded text-sm",placeholder:"Masukkan nama client"})]}),(0,b.jsxs)("div",{className:"md:col-span-2",children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"ADDRESS"}),(0,b.jsx)("input",{type:"text",value:q.address||"",onChange:a=>r(b=>({...b,address:a.target.value})),className:"w-full p-2 border rounded text-sm",placeholder:"Masukkan alamat proyek"})]}),(0,b.jsxs)("div",{className:"md:col-span-2",children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"TIME SCHEDULE"}),(0,b.jsx)("input",{type:"text",value:q.time_schedule||"",onChange:a=>r(b=>({...b,time_schedule:a.target.value})),className:"w-full p-2 border rounded text-sm",placeholder:"Masukkan time schedule"})]}),(0,b.jsxs)("div",{className:"md:col-span-2",children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"DEADLINE *"}),(0,b.jsx)("input",{type:"date",value:q.deadline||"",onChange:a=>r(b=>({...b,deadline:a.target.value})),className:"w-full p-2 border rounded text-sm",min:new Date().toISOString().split("T")[0],required:!0}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Batas akhir pengerjaan proyek"})]}),q.deadline&&(0,b.jsxs)("div",{className:"md:col-span-2",children:[(0,b.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"COUNTDOWN PREVIEW"}),(0,b.jsxs)("div",{className:"p-2 border rounded bg-yellow-50 text-sm",children:[(0,b.jsx)(g,{deadline:q.deadline}),(0,b.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:["Deadline: ",y(q.deadline)]})]})]})]}),(0,b.jsx)("div",{className:"mt-4 p-3 bg-blue-50 rounded border",children:(0,b.jsxs)("p",{className:"text-sm text-blue-700",children:["ðŸ’¡ ",(0,b.jsx)("strong",{children:"Kode proyek otomatis:"}),' P-EUI-NoUrut-Tanggal. Isi Job Name dan Deadline (wajib) lalu klik "Tambah Proyek".']})}),(0,b.jsx)("div",{className:"flex justify-end mt-4",children:(0,b.jsx)("button",{onClick:w,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded font-medium disabled:bg-gray-400 disabled:cursor-not-allowed",disabled:j||!q.job_name?.trim()||!q.deadline,children:j?"â³ Menambahkan...":"âž• Tambah Proyek"})})]}),j&&0===a.length?(0,b.jsx)("div",{className:"flex justify-center py-8",children:(0,b.jsx)("div",{className:"text-gray-600",children:"Memuat data proyek..."})}):0===a.length?(0,b.jsxs)("div",{className:"text-center py-8 text-gray-500 italic",children:[(0,b.jsx)("div",{className:"text-4xl mb-2",children:"ðŸ“‹"}),(0,b.jsx)("p",{children:"Belum ada proyek. Tambahkan proyek baru di atas."})]}):(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold",children:["Proyek Aktif (",a.length,")"]}),(0,b.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:a.map(a=>{let c=a.deadline||a.meta?.deadline||null;return(0,b.jsxs)("div",{className:"p-4 bg-white rounded shadow hover:shadow-md transition border relative",children:[c&&(0,b.jsx)("div",{className:"absolute top-3 right-3",children:(0,b.jsx)(g,{deadline:c})}),(0,b.jsxs)("div",{className:"mb-3 pr-16",children:[(0,b.jsx)("div",{className:"font-semibold text-lg text-gray-800 mb-1",children:a.name}),a.meta?.project_code&&(0,b.jsx)("div",{className:"text-xs text-blue-600 font-medium bg-blue-50 px-2 py-1 rounded inline-block mb-2",children:a.meta.project_code}),a.description&&(0,b.jsx)("div",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:a.description}),(0,b.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[a.meta?.client&&(0,b.jsxs)("div",{children:["ðŸ‘¤ Client: ",a.meta.client]}),a.meta?.address&&(0,b.jsxs)("div",{children:["ðŸ“ ",a.meta.address]}),a.meta?.time_schedule&&(0,b.jsxs)("div",{children:["ðŸ“… Jadwal: ",a.meta.time_schedule]}),a.meta?.created_by&&(0,b.jsxs)("div",{className:"text-xs text-gray-400 mt-2",children:["Dibuat oleh: ",a.meta.created_by]}),c&&(0,b.jsxs)("div",{className:"mt-2 p-2 bg-gray-50 rounded border",children:[(0,b.jsx)("div",{className:"font-medium text-gray-700",children:"â° Deadline"}),(0,b.jsx)("div",{className:"text-gray-600",children:y(c)})]})]})]}),(0,b.jsxs)("div",{className:"flex gap-2 pt-3 border-t",children:[(0,b.jsx)("button",{onClick:()=>{var b;return b=a.id,void(localStorage.setItem("selectedProject",String(b)),"master"===l?p.push(`/projects/${b}/master`):p.push(`/projects/${b}/silver`))},className:"bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 flex-1",children:"Buka Proyek"}),(0,b.jsx)("button",{onClick:()=>x(a.id),className:"bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600",children:"Hapus"})]})]},a.id)})})]})]}):(0,b.jsx)("div",{className:"p-6 min-h-screen bg-gray-100",children:(0,b.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,b.jsx)("div",{className:"text-gray-600",children:"Memuat..."})})})}a.s(["default",()=>i])}];

//# sourceMappingURL=app_projects_page_tsx_eb00fc5b._.js.map