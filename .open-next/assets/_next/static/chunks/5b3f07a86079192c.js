(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,a,t)=>{a.exports=e.r(76562)},35602,e=>{"use strict";var a=e.i(53210);let t=async()=>{let{error:e}=await a.supabase.auth.signOut();e?(console.error("Logout gagal:",e.message),alert("Logout gagal, coba lagi.")):(localStorage.removeItem("userEmail"),localStorage.removeItem("userRole"),localStorage.removeItem("userProfile"),localStorage.removeItem("selectedProject"),window.location.href="/")};e.s(["handleLogout",0,t])},39012,e=>{"use strict";var a=e.i(43476),t=e.i(71645),s=e.i(53210),l=e.i(18566),r=e.i(35602);let d=({deadline:e})=>{let[s,l]=(0,t.useState)({days:0,hours:0,minutes:0,seconds:0,isOverdue:!1});return((0,t.useEffect)(()=>{let a=()=>{let a=new Date().getTime(),t=new Date(e).getTime();if(isNaN(t))return void l({days:0,hours:0,minutes:0,seconds:0,isOverdue:!1});let s=t-a;s<=0?l({days:0,hours:0,minutes:0,seconds:0,isOverdue:!0}):l({days:Math.floor(s/864e5),hours:Math.floor(s%864e5/36e5),minutes:Math.floor(s%36e5/6e4),seconds:Math.floor(s%6e4/1e3),isOverdue:!1})};a();let t=setInterval(a,1e3);return()=>clearInterval(t)},[e]),!e||isNaN(new Date(e).getTime()))?(0,a.jsxs)("div",{className:"flex items-center gap-1 text-gray-500 text-sm",children:[(0,a.jsx)("span",{children:"ðŸ“…"}),(0,a.jsx)("span",{children:"Deadline tidak valid"})]}):s.isOverdue?(0,a.jsxs)("div",{className:"flex items-center gap-1 text-red-600 font-semibold text-sm",children:[(0,a.jsx)("span",{children:"âš "}),(0,a.jsx)("span",{children:"TELAT"})]}):s.days>30?(0,a.jsxs)("div",{className:"flex items-center gap-1 text-green-600 text-sm",children:[(0,a.jsx)("span",{children:"ðŸ“…"}),(0,a.jsxs)("span",{children:[s.days," hari"]})]}):s.days>7?(0,a.jsxs)("div",{className:"flex items-center gap-1 text-orange-500 text-sm",children:[(0,a.jsx)("span",{children:"âŒ›"}),(0,a.jsxs)("span",{children:[s.days," hari"]})]}):s.days>0?(0,a.jsxs)("div",{className:"flex items-center gap-1 text-red-500 font-semibold text-sm",children:[(0,a.jsx)("span",{children:"ðŸš¨"}),(0,a.jsxs)("span",{children:[s.days,"d ",s.hours,"h"]})]}):(0,a.jsxs)("div",{className:"flex items-center gap-1 text-red-600 font-bold text-sm",children:[(0,a.jsx)("span",{children:"ðŸ”¥"}),(0,a.jsxs)("span",{children:[s.hours,"j ",s.minutes,"m ",s.seconds,"d"]})]})},n=()=>{let[e,s]=(0,t.useState)(null),[l,r]=(0,t.useState)(null);return((0,t.useEffect)(()=>{let e=localStorage.getItem("userEmail"),a=localStorage.getItem("userProfile");s(e),r(a)},[]),e)?(0,a.jsxs)("div",{className:"flex items-center gap-3 bg-blue-50 px-3 py-2 rounded-lg border border-blue-200",children:[(0,a.jsx)("img",{src:l||`https://ui-avatars.com/api/?name=${encodeURIComponent(e.split("@")[0])}&background=random`,alt:"Profile",className:"w-8 h-8 rounded-full"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-800",children:e}),(0,a.jsx)("div",{className:"text-xs text-gray-500 capitalize",children:localStorage.getItem("userRole")})]})]}):null};function i(){let[e,i]=(0,t.useState)([]),[o,c]=(0,t.useState)(!1),[m,u]=(0,t.useState)(null),[x,h]=(0,t.useState)(null),g=(0,l.useRouter)(),[p,b]=(0,t.useState)({project_code:"",job_name:"",no_rks:"",date:"",client:"",address:"",time_schedule:"",deadline:""}),[j,f]=(0,t.useState)(!1);(0,t.useEffect)(()=>{f(!0)},[]),(0,t.useEffect)(()=>{!async function(){let{data:{user:e}}=await s.supabase.auth.getUser();if(!e)return g.push("/");let a=localStorage.getItem("userEmail"),t=localStorage.getItem("userRole");if(a&&t)h(a),u(t);else{h(e.email||null);let{data:a,error:t}=await s.supabase.from("users").select("role").eq("email",e.email).single();!t&&a&&(u(a.role),localStorage.setItem("userRole",a.role))}}()},[g]),(0,t.useEffect)(()=>{v();let e=s.supabase.channel("public:projects").on("postgres_changes",{event:"*",schema:"public",table:"projects"},()=>v()).subscribe();return()=>{s.supabase.removeChannel(e)}},[]);let y=async()=>{try{let{count:e}=await s.supabase.from("projects").select("*",{count:"exact",head:!0}),a=new Date().toISOString().split("T")[0].replace(/-/g,"");return`P-EUI-${((e||0)+1).toString().padStart(3,"0")}-${a}`}catch(a){console.error("Error generating project code:",a);let e=new Date().toISOString().split("T")[0].replace(/-/g,"");return`P-EUI-001-${e}`}};async function v(){c(!0);try{let{data:e,error:a}=await s.supabase.from("projects").select("*").order("created_at",{ascending:!1});a?(console.error("fetchProjects error:",a),i([])):i(e||[])}catch(e){console.error("fetchProjects exception:",e),i([])}finally{c(!1)}}async function N(){if(!p.job_name?.trim())return void alert("Job Name harus diisi!");if(!p.deadline)return void alert("Deadline harus diisi!");let e=new Date;if(e.setHours(0,0,0,0),new Date(p.deadline)<e)return void alert("Deadline tidak boleh sebelum hari ini!");c(!0);try{let e=p.project_code||await y(),a={name:p.job_name,description:`Proyek: ${p.job_name} | Client: ${p.client||"-"} | Lokasi: ${p.address||"-"}`,status:"ongoing",meta:{project_code:e,job_name:p.job_name,no_rks:p.no_rks||"",date:p.date||"",client:p.client||"",address:p.address||"",time_schedule:p.time_schedule||"",deadline:p.deadline,created_by:x}};try{a.deadline=p.deadline}catch(e){console.warn("Kolom deadline tidak tersedia, menggunakan meta saja:",e)}let{error:t}=await s.supabase.from("projects").insert(a);if(t)if(console.error("addProject error:",t),t.message.includes("deadline")){console.log("Kolom deadline tidak ditemukan, mencoba tanpa deadline..."),delete a.deadline;let{error:e}=await s.supabase.from("projects").insert(a);if(e)throw e}else throw t;let l=await y();b({project_code:l,job_name:"",no_rks:"",date:new Date().toISOString().split("T")[0],client:"",address:"",time_schedule:"",deadline:""}),v(),alert("âœ… Proyek berhasil ditambahkan!")}catch(e){console.error(e),alert("Terjadi kesalahan: "+e.message)}finally{c(!1)}}async function k(e){if(confirm("Hapus project ini?")){c(!0);try{let{error:a}=await s.supabase.from("projects").delete().eq("id",e);a?(console.error("deleteProject error:",a),alert("Gagal menghapus: "+a.message)):v()}catch(e){console.error(e),alert("Terjadi kesalahan.")}finally{c(!1)}}}(0,t.useEffect)(()=>{!async function(){let e=await y();b(a=>({...a,project_code:e,date:new Date().toISOString().split("T")[0]}))}()},[]);let w=e=>new Date(e).toLocaleDateString("id-ID",{day:"numeric",month:"long",year:"numeric"});return j?(0,a.jsxs)("div",{className:"p-6 min-h-screen bg-gray-100",children:[(0,a.jsxs)("header",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Daftar Proyek"}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(n,{}),(0,a.jsx)("button",{onClick:r.handleLogout,className:"rounded bg-red-500 px-3 py-1 text-white hover:bg-red-600",children:"Logout"})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded shadow p-4 mb-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Tambah Proyek Baru"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 text-sm mb-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"KODE PROYEK"}),(0,a.jsx)("div",{className:"font-semibold text-gray-800 p-2 border rounded bg-gray-50 min-h-[42px]",children:p.project_code||"Generating..."}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Auto-generated"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"JOB NAME *"}),(0,a.jsx)("input",{type:"text",value:p.job_name||"",onChange:e=>b(a=>({...a,job_name:e.target.value})),className:"w-full p-2 border rounded text-sm",placeholder:"Masukkan job name",required:!0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"NO RKS"}),(0,a.jsx)("input",{type:"text",value:p.no_rks||"",onChange:e=>b(a=>({...a,no_rks:e.target.value})),className:"w-full p-2 border rounded text-sm",placeholder:"Masukkan no RKS"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"TANGGAL MULAI"}),(0,a.jsx)("input",{type:"date",value:p.date||"",onChange:e=>b(a=>({...a,date:e.target.value})),className:"w-full p-2 border rounded text-sm"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"CLIENT"}),(0,a.jsx)("input",{type:"text",value:p.client||"",onChange:e=>b(a=>({...a,client:e.target.value})),className:"w-full p-2 border rounded text-sm",placeholder:"Masukkan nama client"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"ADDRESS"}),(0,a.jsx)("input",{type:"text",value:p.address||"",onChange:e=>b(a=>({...a,address:e.target.value})),className:"w-full p-2 border rounded text-sm",placeholder:"Masukkan alamat proyek"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"TIME SCHEDULE"}),(0,a.jsx)("input",{type:"text",value:p.time_schedule||"",onChange:e=>b(a=>({...a,time_schedule:e.target.value})),className:"w-full p-2 border rounded text-sm",placeholder:"Masukkan time schedule"})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"DEADLINE *"}),(0,a.jsx)("input",{type:"date",value:p.deadline||"",onChange:e=>b(a=>({...a,deadline:e.target.value})),className:"w-full p-2 border rounded text-sm",min:new Date().toISOString().split("T")[0],required:!0}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Batas akhir pengerjaan proyek"})]}),p.deadline&&(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-xs font-medium text-gray-500 mb-1",children:"COUNTDOWN PREVIEW"}),(0,a.jsxs)("div",{className:"p-2 border rounded bg-yellow-50 text-sm",children:[(0,a.jsx)(d,{deadline:p.deadline}),(0,a.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:["Deadline: ",w(p.deadline)]})]})]})]}),(0,a.jsx)("div",{className:"mt-4 p-3 bg-blue-50 rounded border",children:(0,a.jsxs)("p",{className:"text-sm text-blue-700",children:["ðŸ’¡ ",(0,a.jsx)("strong",{children:"Kode proyek otomatis:"}),' P-EUI-NoUrut-Tanggal. Isi Job Name dan Deadline (wajib) lalu klik "Tambah Proyek".']})}),(0,a.jsx)("div",{className:"flex justify-end mt-4",children:(0,a.jsx)("button",{onClick:N,className:"bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded font-medium disabled:bg-gray-400 disabled:cursor-not-allowed",disabled:o||!p.job_name?.trim()||!p.deadline,children:o?"â³ Menambahkan...":"âž• Tambah Proyek"})})]}),o&&0===e.length?(0,a.jsx)("div",{className:"flex justify-center py-8",children:(0,a.jsx)("div",{className:"text-gray-600",children:"Memuat data proyek..."})}):0===e.length?(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500 italic",children:[(0,a.jsx)("div",{className:"text-4xl mb-2",children:"ðŸ“‹"}),(0,a.jsx)("p",{children:"Belum ada proyek. Tambahkan proyek baru di atas."})]}):(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold",children:["Proyek Aktif (",e.length,")"]}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:e.map(e=>{let t=e.deadline||e.meta?.deadline||null;return(0,a.jsxs)("div",{className:"p-4 bg-white rounded shadow hover:shadow-md transition border relative",children:[t&&(0,a.jsx)("div",{className:"absolute top-3 right-3",children:(0,a.jsx)(d,{deadline:t})}),(0,a.jsxs)("div",{className:"mb-3 pr-16",children:[(0,a.jsx)("div",{className:"font-semibold text-lg text-gray-800 mb-1",children:e.name}),e.meta?.project_code&&(0,a.jsx)("div",{className:"text-xs text-blue-600 font-medium bg-blue-50 px-2 py-1 rounded inline-block mb-2",children:e.meta.project_code}),e.description&&(0,a.jsx)("div",{className:"text-sm text-gray-600 mb-2 line-clamp-2",children:e.description}),(0,a.jsxs)("div",{className:"text-xs text-gray-500 space-y-1",children:[e.meta?.client&&(0,a.jsxs)("div",{children:["ðŸ‘¤ Client: ",e.meta.client]}),e.meta?.address&&(0,a.jsxs)("div",{children:["ðŸ“ ",e.meta.address]}),e.meta?.time_schedule&&(0,a.jsxs)("div",{children:["ðŸ“… Jadwal: ",e.meta.time_schedule]}),e.meta?.created_by&&(0,a.jsxs)("div",{className:"text-xs text-gray-400 mt-2",children:["Dibuat oleh: ",e.meta.created_by]}),t&&(0,a.jsxs)("div",{className:"mt-2 p-2 bg-gray-50 rounded border",children:[(0,a.jsx)("div",{className:"font-medium text-gray-700",children:"â° Deadline"}),(0,a.jsx)("div",{className:"text-gray-600",children:w(t)})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 pt-3 border-t",children:[(0,a.jsx)("button",{onClick:()=>{var a;return a=e.id,void(localStorage.setItem("selectedProject",String(a)),"master"===m?g.push(`/projects/${a}/master`):g.push(`/projects/${a}/silver`))},className:"bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 flex-1",children:"Buka Proyek"}),(0,a.jsx)("button",{onClick:()=>k(e.id),className:"bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600",children:"Hapus"})]})]},e.id)})})]})]}):(0,a.jsx)("div",{className:"p-6 min-h-screen bg-gray-100",children:(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"text-gray-600",children:"Memuat..."})})})}e.s(["default",()=>i])}]);