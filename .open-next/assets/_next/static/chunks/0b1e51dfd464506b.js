(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,a,s)=>{a.exports=e.r(76562)},31713,e=>{"use strict";var a=e.i(43476),s=e.i(71645),t=e.i(18566),r=e.i(53210);function l(){let[e,l]=(0,s.useState)(""),[i,n]=(0,s.useState)(""),[o,u]=(0,s.useState)(!1),d=(0,t.useRouter)();(0,s.useEffect)(()=>{console.log("SUPABASE URL:","https://qpqjlpqxxluedxgzzatp.supabase.co/"),console.log("SUPABASE KEY:","ADA")},[]),(0,s.useEffect)(()=>{(async()=>{let{data:e}=await r.supabase.auth.getSession();e.session&&d.push("/projects")})()},[d]);let c=async a=>{a.preventDefault(),u(!0);try{if(!e.endsWith("@gmail.com")){alert("Hanya email @gmail.com yang diperbolehkan."),u(!1);return}if(!i.trim()){alert("Password harus diisi."),u(!1);return}let{data:a,error:s}=await r.supabase.auth.signInWithPassword({email:e,password:i});if(s&&s.message.includes("Invalid login credentials")){let a="user";e.includes("admin")||e.includes("master")?a="master":(e.includes("silver")||e.includes("engineer"))&&(a="silver");let{error:s}=await r.supabase.auth.signUp({email:e,password:i,options:{data:{role:a}}});if(s){alert("Pendaftaran gagal: "+s.message),u(!1);return}let{error:t}=await r.supabase.auth.signInWithPassword({email:e,password:i});if(t){alert("Login gagal setelah pendaftaran"),u(!1);return}}else if(s){alert("Login gagal: "+s.message),u(!1);return}let{data:t}=await r.supabase.auth.getUser(),l="user";t?.user?.user_metadata?.role?l=t.user.user_metadata.role:e.includes("admin")||e.includes("master")?l="master":(e.includes("silver")||e.includes("engineer"))&&(l="silver"),localStorage.setItem("userEmail",e),localStorage.setItem("userRole",l),localStorage.setItem("userProfile",`https://ui-avatars.com/api/?name=${encodeURIComponent(e.split("@")[0])}&background=random`);try{await r.supabase.from("users").upsert({email:e,role:l,last_login:new Date().toISOString(),created_at:new Date().toISOString()},{onConflict:"email"})}catch(e){console.warn("Error upsert user:",e)}console.log("Login berhasil dengan role:",l),"master"===l?d.push("/dashboard/master"):"silver"===l?d.push("/dashboard/silver"):d.push("/projects")}catch(e){console.error("Login error:",e),alert("Terjadi kesalahan sistem.")}finally{u(!1)}};return(0,a.jsx)("div",{className:"flex min-h-screen items-center justify-center bg-gray-100",children:(0,a.jsxs)("form",{onSubmit:c,className:"w-full max-w-sm bg-white p-6 rounded shadow",children:[(0,a.jsxs)("div",{className:"mb-4 text-center",children:[(0,a.jsx)("img",{src:"/logo-eltama.png",className:"mx-auto mb-2",onError:e=>{let a=e.currentTarget.parentElement;a&&(a.innerHTML='<div class="w-full h-full bg-blue-600 flex items-center justify-center text-white font-bold">PT EUI</div>')}}),(0,a.jsx)("h1",{className:"font-bold",children:"PT ELEKTRINDO UTAMA INDONESIA"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"MECHANICAL - ELECTRICAL - FIRE PROTECTION"})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("input",{type:"email",value:e,onChange:e=>l(e.target.value),placeholder:"Email Anda (harus @gmail.com)",className:"w-full border p-2 rounded",required:!0}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Contoh: user@gmail.com"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("input",{type:"password",value:i,onChange:e=>n(e.target.value),placeholder:"Password Anda",className:"w-full border p-2 rounded",required:!0}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Password akan dibuat secara otomatis saat pertama kali login"})]}),(0,a.jsxs)("div",{className:"mb-4 text-xs text-gray-600",children:[(0,a.jsx)("p",{className:"font-semibold",children:"Informasi:"}),(0,a.jsxs)("ul",{className:"list-disc pl-4 mt-1",children:[(0,a.jsx)("li",{children:"Email harus menggunakan @gmail.com"}),(0,a.jsx)("li",{children:"Sistem akan membuat akun otomatis untuk pertama kali"}),(0,a.jsx)("li",{children:"Role akan ditentukan berdasarkan email"})]})]}),(0,a.jsx)("button",{disabled:o,className:"w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700 disabled:opacity-50",children:o?"Memproses...":"Login / Buat Akun"}),(0,a.jsxs)("div",{className:"mt-4 text-xs text-gray-500 text-center",children:[(0,a.jsxs)("p",{children:["Â© ",new Date().getFullYear()," PT. Elektindo Utama Indonesia"]}),(0,a.jsx)("p",{children:"Project Management System v1.0"})]})]})})}e.s(["default",()=>l])}]);